<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Scientific Research Evaluation Points Calculator for Promotion to Professor and Associate Professor – Cycle 15</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Inter', Arial, sans-serif;
    background: #f0f2f5;
    color: #1e293b;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    margin: 0 auto 20px;
    max-width: 1350px; /* Slightly wider to accommodate data */
    width: 100%;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    box-sizing: border-box;
  }
  h1 { margin: 0 0 5px; font-size: 22px; color: #0f1724; font-weight: 700; }
  .muted { color: #64748b; font-size: 14px; margin-bottom: 20px; }
  
  /* Table Styling */
  .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid #e2e8f0; }
  table { width: 100%; border-collapse: collapse; min-width: 1000px; }
  th, td {
    border-bottom: 1px solid #e2e8f0;
    border-right: 1px solid #e2e8f0; /* LTR borders */
    padding: 8px 10px;
    text-align: left;
    font-size: 13px;
    vertical-align: middle;
  }
  th:last-child, td:last-child { border-right: none; }
  th { background: #f8fafc; font-weight: 600; color: #475569; white-space: nowrap; }

  /* Inputs & Selects */
  input[type="text"], input[type="number"], select {
    width: 100%; padding: 6px 8px;
    border: 1px solid #cbd5e1; border-radius: 4px;
    font-size: 13px; box-sizing: border-box;
    font-family: inherit; transition: all 0.2s;
  }
  input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }

  /* SHRINK LOGIC: Specific Column Widths */
  .col-idx { width: 40px; text-align: center; }
  .col-title { width: 180px; } /* Shrunk */
  .col-journal { width: 160px; } /* Shrunk */
  .col-spec { width: 90px; }
  .col-eval { width: 90px; }
  .col-grade-sm { width: 60px; }
  .col-num { width: 60px; }
  .col-rank { width: 100px; }
  .col-check { width: 50px; text-align: center; }
  .col-result { width: 80px; }
  
  /* Compact Inputs for Shrunk Columns */
  .col-journal select {
    width: 100%;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }

  /* Enhanced Number Visualization */
  input.grade-display {
    background-color: #f1f5f9;
    font-weight: 600;
    color: #334155;
    text-align: center;
  }
  input.result-display {
    border: 1px solid #94a3b8;
    background-color: #fff;
    font-weight: 700;
    font-size: 14px;
    text-align: center;
  }
  /* Specific colors for results */
  .res-threshold { color: #2563eb; background: #eff6ff !important; border-color: #bfdbfe !important; }
  .res-norm { color: #059669; background: #ecfdf5 !important; border-color: #a7f3d0 !important; }
  .res-part { background: #f8fafc !important; color: #475569; }

  /* Buttons */
  .btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 8px 16px; border-radius: 6px; border: none;
    background: #2563eb; color: #fff; cursor: pointer;
    font-weight: 500; font-size: 13px; transition: 0.2s;
    margin-right: 8px;
  }
  .btn:hover { background: #1d4ed8; }
  .btn.secondary { background: #fff; border: 1px solid #cbd5e1; color: #334155; }
  .btn.secondary:hover { background: #f1f5f9; }
  .btn.danger { background: #fee2e2; color: #991b1b; }
  .btn.danger:hover { background: #fecaca; }
  .del-btn {
    background: #ef4444; color: white; width: 24px; height: 24px;
    border: none; border-radius: 4px; cursor: pointer; display: flex;
    align-items: center; justify-content: center; margin: 0 auto;
  }

  /* Summary Section */
  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  .summary-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
  }
  .summary-label { font-size: 13px; color: #64748b; margin-bottom: 5px; }
  .summary-val { font-size: 28px; font-weight: 800; line-height: 1.2; }
  .val-blue { color: #2563eb; }
  .val-teal { color: #0d9488; }
  
  .status-box { margin-top: 15px; padding: 12px; border-radius: 6px; font-size: 14px; font-weight: 500; }
  .status-ok { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
  .status-warn { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; }

  .actions { display: flex; gap: 8px; margin-bottom: 15px; }
  footer { text-align: center; font-size: 12px; color: #94a3b8; margin-top: auto; padding-top: 20px; }

  @media print {
    .actions, .del-btn, footer { display: none !important; }
    body { background: #fff; padding: 0; }
    .card { box-shadow: none; border: none; margin: 0; padding: 0; max-width: 100%; }
    input, select { border: none; background: transparent; appearance: none; padding: 0; }
    .table-wrapper { border: none; }
    th { border-bottom: 2px solid #000; }
  }
</style>
</head>
<body>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <h1>Scientific Research Evaluation Points Calculator for Promotion to Professor and Associate Professor – Cycle 15</h1>
        <p class="muted">Research evaluation based on Cycle 15 rules & Updated Journal Matrix.</p>
      </div>
    </div>

    <div class="actions">
      <button id="addRowBtn" class="btn">+ Add New Paper</button>
      <button id="exportCSV" class="btn secondary">Export CSV</button>
      <button id="printBtn" class="btn secondary">Print Report</button>
      <button id="resetBtn" class="btn danger" style="margin-left:auto">Reset All</button>
    </div>

    <div class="table-wrapper">
      <table id="researchTable">
        <thead>
          <tr>
            <th class="col-idx">#</th>
            <th class="col-title">Paper Title</th>
            <th class="col-journal">Journal Type</th>
            <th class="col-spec">Specialty</th>
            <th class="col-eval">Eval Type</th>
            <th class="col-grade-sm">Paper<br>Grade</th>
            <th class="col-grade-sm">Jrnl<br>Grade</th>
            <th class="col-num">No.<br>Auth</th>
            <th class="col-rank">Your Rank</th>
            <th class="col-check">Top<br>1%</th>
            <th class="col-result">Share %</th>
            <th class="col-check">CNCI<br>>1</th>
            <th class="col-result">Excellence<br>Points</th>
            <th class="col-result">Promo<br>Points</th>
            <th class="col-check"></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="summary-grid">
      <div class="summary-card">
        <div class="summary-label">Total Excellence Points (Min 60)</div>
        <div class="summary-val val-blue" id="sumThreshold">0.00</div>
      </div>
      <div class="summary-card">
        <div class="summary-label">Total Promotion Points (Normalized)</div>
        <div class="summary-val val-teal" id="sumNormalized">0.00</div>
      </div>
      <div class="summary-card" style="flex:2">
         <div class="summary-label">Status</div>
         <div id="resultMsg"></div>
      </div>
    </div>
    
    <div id="pageMsg" style="margin-top:10px; font-size:13px; color:#0369a1; font-weight:600; text-align:right"></div>
  </div>

  <footer>Designed based on Cycle 15 Regulations</footer>

<script>
// 1. DATABASE CONFIGURATION (English Keys)
// Maps journal types to [Paper Grade, Journal Grade]
const gradesDB = {
  // Grade 10.0
  "WoS Q1 - Top 10%|Specialized": { researchGrade: 100, journalGrade: 10 },
  "WoS Q1 - (Other)|Specialized": { researchGrade: 90, journalGrade: 10 },
  
  // Grade 9.5
  "WoS Q2|Specialized": { researchGrade: 80, journalGrade: 9.5 },
  "Scopus Top 10% (Class A)|Specialized": { researchGrade: 80, journalGrade: 9.5 },
  
  // Grade 9.0
  "Scopus Q1|Specialized": { researchGrade: 75, journalGrade: 9.0 },
  
  // Grade 8.5
  "WoS Q3|Specialized": { researchGrade: 70, journalGrade: 8.5 },
  
  // Grade 8.0
  "Scopus Q2|Specialized": { researchGrade: 70, journalGrade: 8.0 },
  
  // Grade 7.5
  "WoS Q4|Specialized": { researchGrade: 65, journalGrade: 7.5 },
  "Scopus Q3|Specialized": { researchGrade: 65, journalGrade: 7.5 },
  
  // Grade 7.0
  "Scopus Q4|Specialized": { researchGrade: 60, journalGrade: 7.0 },
  "ESCI (WoS/Scopus Emerging)|Specialized": { researchGrade: 60, journalGrade: 7.0 },
  
  // Non-Specialized (For reference/Manual entry)
  "WoS Q1|General": { researchGrade: 0, journalGrade: 6 },
  "WoS Q2|General": { researchGrade: 0, journalGrade: 5.5 },
  "WoS Q3|General": { researchGrade: 0, journalGrade: 4 },
  "WoS Q4|General": { researchGrade: 0, journalGrade: 3 },
  "Scopus Q1|General": { researchGrade: 0, journalGrade: 5 },
  "Scopus Q2|General": { researchGrade: 0, journalGrade: 4.5 },
  "Scopus Q3|General": { researchGrade: 0, journalGrade: 3.5 },
  "Scopus Q4|General": { researchGrade: 0, journalGrade: 2.5 },
  "Evaluation (Other)|General": { researchGrade: 0, journalGrade: 0 }
};

const journalOptions = Object.keys(gradesDB).map(k => {
  const [label, spec] = k.split('|');
  return { key: k, label: label };
});

const tbody = document.getElementById('tbody');
const sumThresholdEl = document.getElementById('sumThreshold');
const sumNormalizedEl = document.getElementById('sumNormalized');
const resultMsg = document.getElementById('resultMsg');
const pageMsg = document.getElementById('pageMsg');

function createSelectJournal(selectedKey) {
  const s = document.createElement('select');
  journalOptions.forEach(opt => {
    const o = document.createElement('option');
    o.value = opt.key;
    o.textContent = opt.label;
    if (opt.key === selectedKey) o.selected = true;
    s.appendChild(o);
  });
  return s;
}

function createRow(data = {}, idx) {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="col-idx">${idx}</td>
    <td class="col-title"><input type="text" class="title" value="${data.title||''}" placeholder="Paper title..."></td>
    <td class="col-journal"></td>
    <td class="col-spec"><select class="spec"><option value="Specialized">Specialized</option><option value="General">General</option></select></td>
    <td class="col-eval"><select class="evalType"><option value="excellence">Excellence</option><option value="evaluation">Evaluation</option></select></td>
    <td class="col-grade-sm"><input type="number" class="researchGrade grade-display" value="0"></td>
    <td class="col-grade-sm"><input type="number" class="journalGrade grade-display" value="0" readonly></td>
    <td class="col-num"><input type="number" class="numResearchers" value="${data.researchers||1}" min="1" style="text-align:center"></td>
    <td class="col-rank">
        <select class="position">
            <option value="first_last">First/Last</option>
            <option value="middle">Co-Author</option>
            <option value="sole">Sole Author</option>
        </select>
    </td>
    <td class="col-check"><input type="checkbox" class="isTop1"${data.isTop1?' checked':''}></td>
    <td class="col-result"><input type="text" class="participation result-display res-part" readonly></td>
    <td class="col-check"><input type="checkbox" class="cnci"${data.cnci?' checked':''}></td>
    <td class="col-result"><input type="number" class="thresholdPoints result-display res-threshold" readonly></td>
    <td class="col-result"><input type="number" class="normalizedPoints result-display res-norm" readonly></td>
    <td class="col-check"><button class="del-btn">×</button></td>`;
  
  const journalCell = tr.querySelector('.col-journal');
  // Default to WoS Q2 if not provided
  const defaultKey = journalOptions.find(o => o.key.includes("WoS Q2"))?.key || journalOptions[0].key;
  const sel = createSelectJournal(data.journalKey || defaultKey); 
  journalCell.appendChild(sel);
  
  const specSel = tr.querySelector('.spec');
  // Initialize spec based on Key
  specSel.value = sel.value.split('|')[1] || 'Specialized';

  const researchInput = tr.querySelector('.researchGrade');
  const evalTypeSel = tr.querySelector('.evalType');

  // Logic to update grades based on selection
  function refreshGrades() {
    const key = sel.value;
    const base = gradesDB[key] || { researchGrade: 0, journalGrade: 0 };
    const evalType = evalTypeSel.value;
    const isSpec = specSel.value === 'Specialized';
    const label = key.split('|')[0];
    
    // Eligibility for "Excellence" (Must be Specialized and Q1/Q2/Top10)
    const isEligible = isSpec && (
        label.includes('WoS Q1') || 
        label.includes('WoS Q2') || 
        label.includes('Scopus Q1') || 
        label.includes('Scopus Top 10%')
    );

    if (evalType === 'excellence') {
        if (isEligible) {
            researchInput.value = base.researchGrade;
            researchInput.readOnly = true;
            researchInput.style.backgroundColor = "#f1f5f9";
            researchInput.placeholder = "";
        } else {
            researchInput.value = 0;
            researchInput.readOnly = true;
        }
    } else {
        // Evaluation mode: Manual entry
        researchInput.readOnly = false;
        researchInput.style.backgroundColor = "#fff";
    }
    
    tr.querySelector('.journalGrade').value = base.journalGrade;
  }

  // Event Listeners
  sel.onchange = () => {
      specSel.value = sel.value.split('|')[1] || 'Specialized';
      refreshGrades(); calculateAll();
  };
  specSel.onchange = evalTypeSel.onchange = () => { refreshGrades(); calculateAll(); };
  
  researchInput.oninput = calculateAll;
  tr.querySelector('.numResearchers').oninput = calculateAll;
  tr.querySelector('.position').onchange = calculateAll;
  tr.querySelector('.isTop1').onchange = calculateAll;
  tr.querySelector('.cnci').onchange = calculateAll;
  tr.querySelector('.del-btn').onclick = () => { tr.remove(); refreshRowIndices(); calculateAll(); };
  
  refreshGrades();
  return tr;
}

function addResearchRow(d) {
    const r = createRow(d, tbody.children.length + 1);
    tbody.appendChild(r);
    refreshRowIndices();
}

function refreshRowIndices() {
    [...tbody.children].forEach((tr, i) => tr.children[0].textContent = i + 1);
}

function calculateAll() {
  let totalT = 0, totalN = 0;
  
  [...tbody.children].forEach(tr => {
    const rg = parseFloat(tr.querySelector('.researchGrade').value) || 0;
    const jg = parseFloat(tr.querySelector('.journalGrade').value) || 0;
    const n = parseInt(tr.querySelector('.numResearchers').value) || 1;
    const pos = tr.querySelector('.position').value;
    const top = tr.querySelector('.isTop1').checked;
    const cnci = tr.querySelector('.cnci').checked;

    // --- Participation Logic (Cycle 15 / Article 22) ---
    let part = 0;
    const isTenPoints = (jg === 10);

    // 1. Always 100% Cases
    if (top || pos === 'sole' || pos === 'first_last') {
        part = 1.0;
    } 
    // 2. High Impact Journals (10 pts)
    else if (isTenPoints) {
        if (n <= 4) part = 1.0;
        else if (n <= 6) part = 0.8;
        else part = 0.6; // 7+
    } 
    // 3. Standard Journals (< 10 pts)
    else {
        if (n === 1) part = 1.0;
        else if (n === 2) part = 0.8;
        else if (n === 3) part = 0.7;
        else if (n === 4) part = 0.55;
        else part = 0.4; // 5+
    }

    // CNCI Bonus
    const bonus = (cnci && rg > 0) ? 1 : 0;
    
    // Excellence Threshold Calculation (Capped at 25 per paper usually, implemented here as standard formula)
    // Formula: (Research Grade * Participation) + Bonus
    let th = (rg * part) + bonus;
    if(th > 25) th = 25; // Cap per Article 23
    
    // Normalized Promotion Points
    // Formula: ((Research Grade * Participation * Journal Grade) / 50) + Bonus
    const norm = ((rg * part * jg) / 50) + bonus;

    tr.querySelector('.participation').value = Math.round(part * 100) + '%';
    tr.querySelector('.thresholdPoints').value = th.toFixed(2);
    tr.querySelector('.normalizedPoints').value = norm.toFixed(2);

    const spec = tr.querySelector('.spec').value;
    const evalType = tr.querySelector('.evalType').value;
    
    // Accumulate Totals
    if (spec === 'Specialized') {
        totalN += norm;
        if (evalType === 'excellence') totalT += th;
    }
  });

  sumThresholdEl.textContent = totalT.toFixed(2);
  sumNormalizedEl.textContent = totalN.toFixed(2);
  
  if (totalT >= 60) {
      resultMsg.innerHTML = `<div class="status-ok">✅ <b>Congratulations!</b> Requirement Met (${totalT.toFixed(2)} ≥ 60)</div>`;
  } else {
      resultMsg.innerHTML = `<div class="status-warn">⚠️ <b>Attention:</b> ${totalT.toFixed(2)} is below the required 60 points.</div>`;
  }
}

function exportCSV() {
  const rows = [["#", "Title", "Journal", "Spec", "Type", "Grade", "J.Grade", "Auth", "Share", "CNCI", "Exc.Pts", "Promo.Pts"]];
  [...tbody.children].forEach((tr, i) => {
    rows.push([
        i + 1,
        `"${tr.querySelector('.title').value}"`, 
        tr.querySelector('.col-journal select').value,
        tr.querySelector('.spec').value,
        tr.querySelector('.evalType').value,
        tr.querySelector('.researchGrade').value,
        tr.querySelector('.journalGrade').value,
        tr.querySelector('.numResearchers').value,
        tr.querySelector('.participation').value,
        tr.querySelector('.cnci').checked ? 'Yes' : 'No',
        tr.querySelector('.thresholdPoints').value,
        tr.querySelector('.normalizedPoints').value
    ]);
  });
  const csv = "\uFEFF" + rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'excellence_points_export.csv';
  a.click();
  pageMsg.textContent = "CSV Exported Successfully ✅";
  setTimeout(() => pageMsg.textContent = "", 3000);
}

function init() {
  // Example Row
  addResearchRow({
      title: "Sample High Impact Paper", 
      journalKey: "Scopus Top 10% (Class A)|Specialized", 
      researchers: 1,
      isTop1: false
  });
  
  document.getElementById('addRowBtn').onclick = () => { addResearchRow({}); calculateAll(); };
  document.getElementById('exportCSV').onclick = exportCSV;
  document.getElementById('printBtn').onclick = () => window.print();
  document.getElementById('resetBtn').onclick = () => {
    if (confirm('Are you sure you want to reset all data?')) {
        tbody.innerHTML = ''; addResearchRow({}); calculateAll();
        pageMsg.textContent = "Reset Complete";
        setTimeout(() => pageMsg.textContent = "", 2000);
    }
  };
  calculateAll();
}
init();
</script>
</body>
</html>


